{"version":3,"file":"index.js","mappings":";;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;AC3FA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;ACzGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACnCA;;;;;;;;AAAA;;;;;;;;AAAA;;;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AC7BA;AACA;;;;AEDA;AACA;AACA;AACA","sources":[".././lib/main.js",".././lib/requests.js",".././lib/tool.js","../../../../../opt/homebrew/lib/node_modules/@vercel/ncc/dist/ncc/@@notfound.js","../webpack/bootstrap","../webpack/runtime/compat","../webpack/before-startup","../webpack/startup","../webpack/after-startup"],"sourcesContent":["\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst core = __importStar(require(\"@actions/core\"));\nconst requests_1 = require(\"./requests\");\nconst tool_1 = require(\"./tool\");\nfunction run() {\n    return __awaiter(this, void 0, void 0, function* () {\n        try {\n            const githubToken = (0, tool_1.loadInput)('githubToken');\n            const githubOrg = (0, tool_1.loadInput)('githubOrg');\n            const githubRepository = (0, tool_1.loadInput)('githubRepository');\n            const githubRunId = (0, tool_1.loadInput)('githubRunId');\n            const elasticApiKeyId = (0, tool_1.loadInput)('elasticApiKeyId');\n            const elasticApiKey = (0, tool_1.loadInput)('elasticApiKey');\n            const elasticHost = (0, tool_1.loadInput)('elasticHost');\n            const elasticIndex = (0, tool_1.loadInput)('elasticIndex');\n            const elasticUser = (0, tool_1.loadInput)('elasticUser');\n            const elasticPassword = (0, tool_1.loadInput)('elasticPassword');\n            const elasticCloudId = (0, tool_1.loadInput)('elasticCloudId');\n            const elasticCloudUser = (0, tool_1.loadInput)('elasticCloudUser');\n            const elasticCloudPassword = (0, tool_1.loadInput)('elasticCloudPassword');\n            core.info(`Initializing Github Connection Instance`);\n            const githubInstance = (0, requests_1.createAxiosGithubInstance)(githubToken);\n            core.info(`Initializing Elastic Instance`);\n            const elasticInstance = (0, requests_1.createElasticInstance)(elasticHost, elasticApiKeyId, elasticApiKey, elasticUser, elasticPassword, elasticCloudId, elasticCloudUser, elasticCloudPassword);\n            const metadataUrl = `/repos/${githubOrg}/${githubRepository}/actions/runs/${githubRunId}`;\n            core.info(`Retrieving metadata from Github Pipeline ${githubRunId}`);\n            const metadata = yield (0, requests_1.sendRequestToGithub)(githubInstance, metadataUrl);\n            const jobsUrl = metadata.jobs_url;\n            core.info(`Retrieving jobs list from Github Pipeline ${githubRunId}`);\n            const jobs = yield (0, requests_1.sendRequestToGithub)(githubInstance, jobsUrl);\n            for (const job of jobs.jobs) {\n                core.info(`Parsing Job... '${job.name}'`);\n                if (/elastic/.test(job.name)) {\n                    core.info('Skipping this job');\n                    continue;\n                }\n                const achievedJob = {\n                    id: job.id,\n                    name: job.name,\n                    metadata,\n                    status: job.status,\n                    conclusion: job.conclusion,\n                    steps: job.steps,\n                    details: job,\n                    logs: yield (0, requests_1.sendRequestToGithub)(githubInstance, `/repos/${githubOrg}/${githubRepository}/actions/jobs/${job.id}/logs`)\n                };\n                core.info(`Getting job '${achievedJob.name}'`);\n                yield (0, requests_1.sendMessagesToElastic)(elasticInstance, achievedJob, elasticIndex);\n            }\n        }\n        catch (e) {\n            if (e instanceof Error) {\n                core.setFailed(e.message);\n            }\n        }\n    });\n}\n// eslint-disable-next-line @typescript-eslint/no-floating-prom\nrun();\n","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.createElasticInstance = exports.createAxiosGithubInstance = exports.sendMessagesToElastic = exports.sendRequestToGithub = void 0;\nconst core = __importStar(require(\"@actions/core\"));\nconst axios_1 = __importDefault(require(\"axios\"));\nconst elasticsearch_1 = require(\"@elastic/elasticsearch\");\nfunction sendRequestToGithub(client, path, retries = 10, initialDelay = 2000, maxDelay = 30000) {\n    return __awaiter(this, void 0, void 0, function* () {\n        let delay = initialDelay;\n        for (let attempt = 1; attempt <= retries; attempt++) {\n            try {\n                const response = yield client.get(path);\n                core.debug(response.data);\n                return response.data;\n            }\n            catch (e) {\n                const error = e;\n                // if (attempt === retries || (error.response && error.response.status !== 404 && error.response.status !== 429 && error.response.status < 500)) {\n                //   throw new Error(`Cannot send request to Github after ${retries} attempts: ${e}`)\n                // }\n                core.warning(`Attempt ${attempt} failed: ${e}. Retrying in ${delay}ms...`);\n                yield new Promise(resolve => setTimeout(resolve, delay));\n                delay = Math.min(delay * 2, maxDelay); // Exponential backoff with a cap\n            }\n        }\n    });\n}\nexports.sendRequestToGithub = sendRequestToGithub;\nfunction sendMessagesToElastic(client, messages, elasticIndex) {\n    return __awaiter(this, void 0, void 0, function* () {\n        try {\n            core.debug(`Push to elasticIndex`);\n            yield client.index({ body: messages, index: elasticIndex });\n            core.debug(`Successfully pushed to elasticIndex`);\n        }\n        catch (e) {\n            core.error(`Failed to send to Elastic: ${e}`);\n            throw new Error(`Cannot send request to Elastic : ${e}`);\n        }\n    });\n}\nexports.sendMessagesToElastic = sendMessagesToElastic;\nfunction createAxiosGithubInstance(token) {\n    return __awaiter(this, void 0, void 0, function* () {\n        return axios_1.default.create({\n            baseURL: 'https://api.github.com',\n            timeout: 10000,\n            headers: { Authorization: `token ${token}` }\n        });\n    });\n}\nexports.createAxiosGithubInstance = createAxiosGithubInstance;\nfunction createElasticInstance(elasticHost, elasticApiKeyId, elasticApiKey, elasticUser, elasticPassword, elasticCloudId, elasticCloudUser, elasticCloudPassword) {\n    return !elasticCloudId\n        ? new elasticsearch_1.Client({\n            node: elasticHost,\n            apiKey: {\n                id: elasticApiKeyId,\n                api_key: elasticApiKey\n            }\n        })\n        : new elasticsearch_1.Client({\n            node: elasticHost,\n            cloud: { id: elasticCloudId },\n            auth: {\n                username: elasticCloudUser,\n                password: elasticCloudPassword\n            }\n        });\n}\nexports.createElasticInstance = createElasticInstance;\n","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.loadInput = void 0;\nconst core = __importStar(require(\"@actions/core\"));\nfunction loadInput(inputName) {\n    try {\n        return core.getInput(inputName);\n    }\n    catch (e) {\n        throw new Error(`Cannot retrieve parameters ${inputName}`);\n    }\n}\nexports.loadInput = loadInput;\n",null,"// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\tvar threw = true;\n\ttry {\n\t\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\t\tthrew = false;\n\t} finally {\n\t\tif(threw) delete __webpack_module_cache__[moduleId];\n\t}\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","\nif (typeof __webpack_require__ !== 'undefined') __webpack_require__.ab = __dirname + \"/\";","","// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = __webpack_require__(778);\n",""],"names":[],"sourceRoot":""}